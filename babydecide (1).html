<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkinDecide Baby ‚Äî Evidence-Based Baby Skincare</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&family=Fraunces:ital,wght@0,300;0,600;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f0f4ee;
    --surface: #f7faf6;
    --ink: #1c211a;
    --ink-muted: #5a6557;
    --accent: #5a8f6a;
    --accent-light: #d8ead9;
    --green: #3d7a52;
    --green-light: #d0e8d4;
    --amber: #8a7340;
    --amber-light: #f2e8cc;
    --border: #d0dace;
    --card: #ffffff;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--ink); font-family: 'DM Mono', monospace; font-size: 13px; min-height: 100vh; overflow-x: hidden; }
  body::before { content: ''; position: fixed; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E"); pointer-events: none; z-index: 999; opacity: 0.5; }

  nav { display: flex; align-items: center; justify-content: space-between; padding: 20px 40px; border-bottom: 1px solid var(--border); background: var(--surface); position: sticky; top: 0; z-index: 100; }
  .logo { font-family: 'DM Serif Display', serif; font-size: 22px; letter-spacing: -0.5px; display: flex; align-items: center; gap: 8px; }
  .logo-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; display: inline-block; }
  .logo-sub { font-family: 'DM Mono', monospace; font-size: 9px; text-transform: uppercase; letter-spacing: 0.15em; color: var(--ink-muted); margin-left: 2px; }
  .nav-tabs { display: flex; gap: 4px; }
  .nav-tab { padding: 6px 14px; border: 1px solid transparent; border-radius: 4px; cursor: pointer; font-family: 'DM Mono', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--ink-muted); background: none; transition: all 0.2s; }
  .nav-tab:hover { color: var(--ink); border-color: var(--border); }
  .nav-tab.active { background: var(--ink); color: var(--bg); border-color: var(--ink); }

  .main { max-width: 1100px; margin: 0 auto; padding: 40px 40px 80px; }
  .section { display: none; animation: fadeUp 0.3s ease; }
  .section.active { display: block; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

  .section-header { margin-bottom: 32px; }
  .section-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.15em; color: var(--ink-muted); margin-bottom: 10px; }
  .section-title { font-family: 'Fraunces', serif; font-size: 40px; font-weight: 300; letter-spacing: -1px; line-height: 1.1; }
  .section-title em { font-style: italic; color: var(--accent); }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 24px; }
  .card-title { font-family: 'DM Serif Display', serif; font-size: 15px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
  .card-icon { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }

  .form-group { margin-bottom: 16px; }
  label { display: block; font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--ink-muted); margin-bottom: 6px; }
  select, input[type="text"], input[type="number"] { width: 100%; padding: 10px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; font-family: 'DM Mono', monospace; font-size: 13px; color: var(--ink); outline: none; transition: border-color 0.2s; }
  select:focus, input:focus { border-color: var(--accent); }

  .checkbox-group { display: flex; flex-wrap: wrap; gap: 6px; }
  .checkbox-chip { padding: 6px 12px; border: 1px solid var(--border); border-radius: 20px; cursor: pointer; font-size: 11px; transition: all 0.15s; user-select: none; }
  .checkbox-chip:hover { border-color: var(--accent); }
  .checkbox-chip.selected { background: var(--accent); color: white; border-color: var(--accent); }

  .btn { padding: 10px 20px; border-radius: 6px; cursor: pointer; font-family: 'DM Mono', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; border: none; transition: all 0.2s; }
  .btn-primary { background: var(--ink); color: var(--bg); }
  .btn-primary:hover { background: var(--accent); }
  .btn-outline { background: none; border: 1px solid var(--border); color: var(--ink-muted); }
  .btn-outline:hover { border-color: var(--ink); color: var(--ink); }
  .btn-small-inline { padding: 8px 14px; font-size: 10px; display: inline-flex; align-items: center; }

  .tag { display: inline-flex; align-items: center; padding: 3px 8px; border-radius: 4px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.06em; font-weight: 500; }
  .tag-green { background: var(--green-light); color: var(--green); }
  .tag-amber { background: var(--amber-light); color: var(--amber); }
  .tag-red { background: #fde8e8; color: #b83232; }
  .tag-muted { background: #e8ece6; color: var(--ink-muted); }

  .alert { display: flex; gap: 12px; padding: 14px 16px; border-radius: 8px; font-size: 12px; line-height: 1.6; margin-bottom: 12px; }
  .alert-green { background: var(--green-light); border: 1px solid #a8d4b2; }
  .alert-amber { background: var(--amber-light); border: 1px solid #d4c080; }
  .alert-red { background: #fde8e8; border: 1px solid #f0b0b0; }

  .divider { border: none; border-top: 1px solid var(--border); margin: 20px 0; }
  .help-text { font-size: 11px; color: var(--ink-muted); line-height: 1.6; }
  .profile-chip { display: inline-flex; align-items: center; gap: 5px; padding: 5px 12px; background: var(--accent-light); border-radius: 20px; font-size: 11px; color: var(--accent); margin: 3px; font-family: 'DM Mono', monospace; }
  .step-num { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: var(--ink); color: var(--bg); border-radius: 50%; font-size: 10px; margin-right: 8px; flex-shrink: 0; }
  .routine-step-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; display: flex; align-items: center; color: var(--ink-muted); margin-bottom: 3px; }

  /* INGREDIENT ROWS */
  .ingredient-row { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); }
  .ingredient-row:last-child { border-bottom: none; }
  .ingredient-bar { flex: 1; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .ingredient-bar-fill { height: 100%; border-radius: 2px; }

  /* PRODUCT RESULT */
  .product-result { animation: fadeUp 0.3s ease; }
  .product-header { display: flex; align-items: flex-start; justify-content: space-between; padding: 20px 0; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
  .product-name { font-family: 'DM Serif Display', serif; font-size: 24px; margin-bottom: 4px; }
  .product-brand { font-size: 11px; color: var(--ink-muted); text-transform: uppercase; letter-spacing: 0.08em; }

  /* SCORE RINGS */
  .score-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; }
  .score-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; display: flex; flex-direction: column; align-items: center; }
  .score-ring { position: relative; width: 80px; height: 80px; margin-bottom: 12px; }
  .score-ring svg { transform: rotate(-90deg); }
  .score-ring-num { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-family: 'DM Serif Display', serif; font-size: 22px; }
  .score-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--ink-muted); text-align: center; }

  /* MOBILE */
  @media (max-width: 768px) {
    nav { padding: 0 12px; flex-direction: row; align-items: center; gap: 0; position: sticky; top: 0; z-index: 200; box-shadow: 0 2px 12px rgba(0,0,0,0.06); height: 52px; }
    .logo { font-size: 15px; flex-shrink: 0; padding-right: 12px; border-right: 1px solid var(--border); height: 100%; display: flex; align-items: center; gap: 6px; white-space: nowrap; }
    .logo-dot { width: 7px; height: 7px; }
    .logo-sub { display: none; }
    .nav-tabs { flex: 1; display: flex; overflow-x: auto; scrollbar-width: none; height: 100%; }
    .nav-tabs::-webkit-scrollbar { display: none; }
    .nav-tab { flex: 0 0 auto; padding: 0 11px; font-size: 9px; border-radius: 0; border: none; border-bottom: 2px solid transparent; height: 100%; display: flex; align-items: center; letter-spacing: 0.04em; white-space: nowrap; }
    .nav-tab.active { background: none; color: var(--ink); border-bottom-color: var(--accent); }
    .main { padding: 20px 16px 60px; }
    body { font-size: 14px; }
    .section-title { font-size: 28px; }
    .grid-2, .grid-3, .score-grid { grid-template-columns: 1fr; gap: 12px; }
    .score-grid { grid-template-columns: 1fr 1fr !important; }
    .card { padding: 16px; }
    select, input[type="text"], input[type="number"] { padding: 14px; font-size: 16px; border-radius: 8px; }
    .btn { padding: 15px 20px; font-size: 13px; border-radius: 8px; width: 100%; text-align: center; }
    .btn-small-inline { width: auto; padding: 10px 14px; font-size: 12px; }
    .checkbox-chip { padding: 10px 16px; font-size: 13px; }
  }
</style>
</head>
<body>

<nav>
  <div class="logo">
    <span class="logo-dot"></span>
    SkinDecide<span class="logo-sub">&nbsp;Baby</span>
  </div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showSection('profile')">Profile</button>
    <button class="nav-tab" onclick="showSection('scanner')">Scanner</button>
    <button class="nav-tab" onclick="showSection('score')">Score</button>
    <button class="nav-tab" onclick="openAbout()" style="opacity:0.6;">About</button>
  </div>
</nav>

<div class="main">

  <!-- PROFILE -->
  <div class="section active" id="section-profile">
    <div class="section-header">
      <div class="section-label">Step 01 ‚Äî Baby Profile</div>
      <h1 class="section-title">Gentle by design.<br><em>Not by marketing.</em></h1>
    </div>

    <div id="profiles-list" style="margin-bottom:24px;"></div>

    <div id="profile-form-card" class="card">
      <div class="card-title" id="profile-form-title"><span class="card-icon" style="background:#d8ead9">+</span> New Baby Profile</div>
      <div class="form-group">
        <label>Profile Name (e.g. "Emma", "Our Baby")</label>
        <input type="text" id="profileName" placeholder="e.g. Emma">
      </div>
      <div class="grid-2">
        <div>
          <div class="form-group">
            <label>Age</label>
            <select id="babyAge">
              <option value="">Select age</option>
              <option value="newborn">Newborn (0‚Äì4 weeks)</option>
              <option value="infant">Infant (1‚Äì6 months)</option>
              <option value="baby">Baby (6‚Äì12 months)</option>
              <option value="toddler">Toddler (1‚Äì3 years)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Skin Type</label>
            <select id="skinType">
              <option value="">Select type</option>
              <option value="normal">Normal ‚Äî balanced, soft</option>
              <option value="dry">Dry ‚Äî flaky, tight</option>
              <option value="sensitive">Sensitive ‚Äî reactive, prone to redness</option>
              <option value="eczema">Eczema-prone ‚Äî itchy, inflamed patches</option>
            </select>
          </div>
        </div>
        <div>
          <div class="form-group">
            <label>Known Conditions</label>
            <div class="checkbox-group" id="conditions">
              <div class="checkbox-chip" onclick="toggleChip(this)">Eczema (atopic)</div>
              <div class="checkbox-chip" onclick="toggleChip(this)">Cradle cap</div>
              <div class="checkbox-chip" onclick="toggleChip(this)">Nappy rash</div>
              <div class="checkbox-chip" onclick="toggleChip(this)">Milk allergy</div>
              <div class="checkbox-chip" onclick="toggleChip(this)">Fragrance sensitivity</div>
              <div class="checkbox-chip" onclick="toggleChip(this)">None</div>
            </div>
          </div>
          <div class="form-group">
            <label>Primary Concern</label>
            <select id="primaryConcern">
              <option value="">Select concern</option>
              <option value="barrier">Barrier protection & hydration</option>
              <option value="eczema">Eczema / dry skin management</option>
              <option value="cradlecap">Cradle cap</option>
              <option value="nappy">Nappy rash prevention</option>
              <option value="sensitive">Sensitive / reactive skin</option>
              <option value="maintenance">General maintenance</option>
            </select>
          </div>
        </div>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn btn-primary btn-small-inline" onclick="saveProfile()">Save Profile ‚Üí</button>
        <button class="btn btn-outline btn-small-inline" id="cancel-edit-btn" style="display:none" onclick="cancelEdit()">Cancel</button>
      </div>
    </div>

    <div id="profile-result" style="display:none; margin-top:24px;">
      <div class="card">
        <div class="card-title"><span class="card-icon" style="background:#d8ead9">‚úì</span> <span id="profile-result-name">Routine Architecture</span></div>
        <div id="profile-chips" style="margin-bottom:20px;"></div>
        <hr class="divider">
        <div style="font-family:'DM Serif Display',serif; font-size:13px; margin-bottom:8px;">Evidence-Based Baby Routine</div>
        <div class="help-text" style="margin-bottom:16px;">Gentle, clinically-informed recommendations for baby's developing skin barrier. Baby skin is 20‚Äì30% thinner than adult skin and significantly more permeable.</div>
        <div id="routine-architecture"></div>
      </div>
    </div>
  </div>

  <!-- SCANNER -->
  <div class="section" id="section-scanner">
    <div class="section-header">
      <div class="section-label">Step 02 ‚Äî Ingredient Check</div>
      <h1 class="section-title">What's in the<br><em>baby lotion?</em></h1>
    </div>
    <div id="scanner-input">
      <div class="card" style="margin-bottom:16px;">
        <div class="card-title"><span class="card-icon" style="background:#d8ead9">‚¨°</span> Paste INCI Ingredient List</div>
        <div class="help-text" style="margin-bottom:12px;">Find the ingredient list on the packaging or brand website. Baby products need stricter scrutiny ‚Äî skin is more permeable and absorbs more.</div>
        <textarea id="inci-input" placeholder="e.g. Aqua, Glycerin, Cetearyl Alcohol, Ceramide NP, Parfum..."
          style="width:100%; height:120px; padding:14px; background:var(--bg); border:1px solid var(--border); border-radius:8px; font-family:'DM Mono',monospace; font-size:13px; resize:vertical; outline:none; color:var(--ink); line-height:1.6;"></textarea>
        <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn btn-primary btn-small-inline" onclick="analyzeINCIInput()">Analyze ‚Üí</button>
          <button class="btn btn-outline btn-small-inline" onclick="simulateScan()">Load Demo</button>
        </div>
      </div>
      <div class="alert alert-amber" style="font-size:11px;">
        <span>‚ö†</span>
        <div><strong>Baby skin is not mini adult skin.</strong> Higher surface-area-to-volume ratio means ingredients absorb more readily into the bloodstream. Fragrance, preservatives, and certain emulsifiers that are "safe" for adults warrant extra caution in babies under 12 months.</div>
      </div>
    </div>
    <div id="scanner-result" style="display:none; margin-top:32px;" class="product-result">
      <div class="product-header">
        <div>
          <div class="product-name" id="product-name">Demo Product</div>
          <div class="product-brand" id="product-brand">Baby Analysis</div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'DM Serif Display',serif; font-size:32px;" id="risk-score">‚Äî</div>
          <div style="font-size:11px; color:var(--ink-muted); text-transform:uppercase; letter-spacing:0.08em">Safety Score</div>
        </div>
      </div>
      <div id="alerts-area"></div>
      <div class="grid-2" style="margin-top:16px;">
        <div class="card">
          <div class="card-title"><span class="card-icon" style="background:#d8ead9">‚úì</span> Beneficial Ingredients</div>
          <div id="active-ingredients"></div>
        </div>
        <div class="card">
          <div class="card-title"><span class="card-icon" style="background:#fde8e8">‚ö†</span> Watch List for Babies</div>
          <div id="watch-ingredients"></div>
          <div id="watch-empty" style="display:none; color:var(--ink-muted); font-size:12px; padding:12px 0;">No flagged ingredients detected.</div>
        </div>
      </div>
      <div class="card" style="margin-top:16px;">
        <div class="card-title">All Ingredients ‚Äî Concentration Order</div>
        <div class="help-text" style="margin-bottom:12px;">INCI lists ordered highest ‚Üí lowest. First 5 ingredients = ~80% of the formula.</div>
        <div id="all-ingredients"></div>
      </div>
      <div style="margin-top:20px;">
        <button class="btn btn-outline btn-small-inline" onclick="resetScanner()">Check Another Product</button>
      </div>
    </div>
  </div>

  <!-- SCORE -->
  <div class="section" id="section-score">
    <div class="section-header">
      <div class="section-label">Step 03 ‚Äî Routine Audit</div>
      <h1 class="section-title">How gentle<br><em>is gentle enough?</em></h1>
    </div>
    <div id="score-content">
      <div class="alert alert-green">
        <span>‚óã</span>
        <div>Add a baby profile and scan products to generate a routine safety score. Score considers fragrance load, preservative types, and barrier ingredient quality.</div>
      </div>
    </div>
  </div>

</div>

<!-- ABOUT MODAL -->
<div id="about-modal" style="display:none; position:fixed; inset:0; z-index:1000; background:rgba(28,33,26,0.6); backdrop-filter:blur(4px); overflow-y:auto;">
  <div style="max-width:560px; margin:40px auto; background:var(--surface); border-radius:12px; padding:40px; position:relative; border:1px solid var(--border);">
    <button onclick="closeAbout()" style="position:absolute; top:16px; right:16px; background:none; border:1px solid var(--border); border-radius:4px; padding:6px 10px; cursor:pointer; font-family:'DM Mono',monospace; font-size:12px; color:var(--ink-muted);">‚úï Close</button>
    <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
      <span class="logo-dot"></span>
      <span style="font-family:'DM Serif Display',serif; font-size:22px;">SkinDecide Baby</span>
    </div>
    <div style="font-family:'Fraunces',serif; font-size:22px; font-weight:300; margin-bottom:8px; line-height:1.2;">Gentle by design.<br><em style="color:var(--accent)">Not by marketing.</em></div>
    <div style="font-size:12px; color:var(--ink-muted); margin-bottom:24px; line-height:1.7;">A sister product to SkinDecide, built specifically for baby and infant skincare. Evidence-based ingredient analysis adapted for developing skin barriers and higher absorption rates.</div>
    <div style="border-top:1px solid var(--border); padding-top:20px; margin-bottom:16px;">
      <div style="font-family:'DM Serif Display',serif; font-size:15px; margin-bottom:10px;">Privacy & Terms</div>
      <div style="font-size:12px; color:var(--ink-muted); line-height:1.8;"><strong style="color:var(--ink);">No data stored.</strong> All profiles exist in session memory only ‚Äî deleted when you close this tab. No personal data collected or transmitted. <strong style="color:var(--ink);">Not medical advice.</strong> Always consult a paediatric dermatologist for clinical skin conditions in infants.</div>
    </div>
    <div style="font-size:11px; color:var(--ink-muted); border-top:1px solid var(--border); padding-top:16px;">Part of the SkinDecide family ¬∑ Evidence-based beauty decisions</div>
  </div>
</div>

<script>
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('section-' + id).classList.add('active');
  event.currentTarget.classList.add('active');
}
function toggleChip(el) { el.classList.toggle('selected'); }
function selectOne(el, groupId) { el.closest('#' + groupId).querySelectorAll('.checkbox-chip').forEach(c => c.classList.remove('selected')); el.classList.add('selected'); }
function openAbout() { document.getElementById('about-modal').style.display = 'block'; document.body.style.overflow = 'hidden'; }
function closeAbout() { document.getElementById('about-modal').style.display = 'none'; document.body.style.overflow = ''; }
document.getElementById('about-modal').addEventListener('click', function(e) { if (e.target === this) closeAbout(); });

// ====== ROUTINE DB ======
const routineDB = {
  barrier: [
    { step: 'Bath', time: 'Daily or every other day', actives: 'Lukewarm water (37¬∞C) ¬∑ max 5‚Äì10 min ¬∑ fragrance-free wash', evidence: 'High', note: 'Over-bathing strips the natural vernix and developing acid mantle. 2‚Äì3 baths per week is sufficient for newborns. Use only plain water or a pH-neutral (5.5‚Äì6.0) baby wash. Avoid all bubble baths.', ingredients: 'Aqua only ¬∑ or pH-neutral syndets ¬∑ no SLS, no fragrance', avoid: 'Hot water ¬∑ bubble bath ¬∑ adult body wash ¬∑ scrubbing' },
    { step: 'Moisturiser', time: 'After every bath ¬∑ within 3 min', actives: 'Emollient-rich cream or ointment ¬∑ Ceramides + Petrolatum', evidence: 'Very High', note: 'Baby skin loses water 2‚Äì3√ó faster than adult skin (TEWL). Apply within 3 minutes of bathing to lock in moisture ‚Äî the "soak and seal" method. Thick creams and ointments outperform lotions. Ceramide-containing products are ideal.', ingredients: 'Ceramide NP/AP ¬∑ Petrolatum ¬∑ Glycerin ¬∑ Shea butter ¬∑ no fragrance', avoid: 'Lotions (too thin) ¬∑ fragrance ¬∑ anything with "natural" essential oils ¬∑ nut oils (allergy risk)' },
    { step: 'SPF', time: 'AM ‚Äî outdoors only, 6+ months', actives: 'Mineral SPF50+ (Zinc Oxide / Titanium Dioxide only)', evidence: 'Very High', note: 'No sunscreen before 6 months ‚Äî keep babies in shade and protective clothing instead. From 6 months: mineral-only SPF50+ on exposed areas. Chemical UV filters not recommended due to higher skin absorption. Reapply every 2 hours outdoors.', ingredients: 'Zinc Oxide 10‚Äì20% ¬∑ Titanium Dioxide ¬∑ no oxybenzone, no octinoxate', avoid: 'Any SPF under 6 months of age ¬∑ chemical UV filters ¬∑ sprays (inhalation risk)' },
  ],
  eczema: [
    { step: 'Cleanse', time: 'Daily ‚Äî lukewarm, quick', actives: 'Syndet bar pH 5.5 ¬∑ fragrance-free ¬∑ soap-free', evidence: 'High', note: 'Soap disrupts the acid mantle and removes ceramides ‚Äî critical to avoid in eczema. Use syndet (synthetic detergent) at physiological pH. Keep baths to 5‚Äì10 minutes maximum in lukewarm water.', ingredients: 'Sodium Cocoyl Isethionate ¬∑ Cocamidopropyl Betaine ¬∑ pH 5.5 ¬∑ no SLS, no soap, no fragrance', avoid: 'Soap ¬∑ bubble bath ¬∑ SLS ¬∑ any fragrance ¬∑ hot water' },
    { step: 'Emollient', time: 'Minimum 2√ó daily ‚Äî especially after bathing', actives: 'Ceramide cream or medical emollient (250‚Äì500g/week for eczema)', evidence: 'Very High', note: 'The cornerstone of eczema management in infants. Regular emollient application reduces flares by 50% (BEEP trial evidence). Use generous amounts ‚Äî 250g/week minimum for eczema babies. The 3:1:1 ceramide:cholesterol:fatty acid ratio mimics the skin lipid barrier.', ingredients: 'Ceramide NP + AP + EOP ¬∑ Cholesterol ¬∑ Linoleic acid ¬∑ Petrolatum or Paraffin ¬∑ no fragrance', avoid: 'Olive oil (disrupts skin barrier in eczema) ¬∑ nut oils ¬∑ fragrance ¬∑ anything with >10 ingredients for sensitive skin' },
    { step: 'Topical Corticosteroid', time: 'As prescribed ‚Äî flares only', actives: 'Hydrocortisone 1% (OTC) or prescribed strength', evidence: 'Very High', note: 'First-line treatment for eczema flares. Short-term use (5‚Äì7 days) on affected areas only. Hydrocortisone 1% is safe for short-term use from 2 years; in infants consult a GP or paediatric dermatologist. Apply before emollient, leave 30 min gap.', ingredients: 'Hydrocortisone 1% ¬∑ always seek medical guidance for infants under 2', avoid: 'Using on face without medical guidance ¬∑ using for longer than 7 days ¬∑ stopping suddenly during a flare' },
    { step: 'Trigger avoidance', time: 'Ongoing', actives: 'Fragrance elimination ¬∑ temperature control ¬∑ clothing materials', evidence: 'High', note: 'Wool and synthetic fabrics worsen eczema ‚Äî use 100% cotton. Keep room temperature at 18‚Äì20¬∞C. Wash all new clothing before use with fragrance-free detergent. Avoid overheating.', ingredients: '100% cotton clothing ¬∑ fragrance-free detergent (e.g. Surcare, Ecover) ¬∑ no fabric softener', avoid: 'Wool ¬∑ synthetic fabrics ¬∑ scented detergents ¬∑ fabric softeners ¬∑ overheating' },
  ],
  cradlecap: [
    { step: 'Soften', time: 'Night before treatment', actives: 'Coconut oil or baby mineral oil applied to scalp', evidence: 'Medium', note: 'Apply a small amount of coconut oil or pure mineral oil to the scalp and leave overnight (or 30 minutes). This softens the crusts before gentle removal. Cradle cap (seborrhoeic dermatitis) is caused by overactive sebaceous glands, not poor hygiene ‚Äî it resolves on its own by 6‚Äì12 months.', ingredients: 'Refined coconut oil (topical use only) ¬∑ Mineral oil ¬∑ no fragrance', avoid: 'Vigorous scrubbing ¬∑ strong antifungal shampoos without medical advice ¬∑ picking at crusts' },
    { step: 'Gentle wash', time: 'After softening', actives: 'Baby shampoo ¬∑ soft brush or cloth', evidence: 'Medium-High', note: 'After softening, gently wash the scalp with a fragrance-free baby shampoo. Use a soft-bristled baby brush or washcloth in circular movements. Do not forcibly remove scales ‚Äî this risks infection. Repeat 2‚Äì3√ó per week.', ingredients: 'Fragrance-free baby shampoo ¬∑ pH neutral ¬∑ soft brush', avoid: 'Picking ¬∑ forcible removal ¬∑ adult dandruff shampoos (selenium sulfide, ketoconazole) without medical advice' },
  ],
  nappy: [
    { step: 'Change frequency', time: 'Every 2‚Äì3 hours ¬∑ immediately when soiled', actives: 'Frequent nappy changes are the most effective prevention', evidence: 'Very High', note: 'Nappy rash is caused by prolonged contact with urine and faeces, not by any ingredient deficiency. Frequent changing reduces contact time. Superabsorbent nappies keep skin drier than cloth.', ingredients: '‚Äî (non-product step)', avoid: 'Leaving soiled nappies on ¬∑ wet wipes with fragrance or alcohol' },
    { step: 'Cleanse', time: 'At every nappy change', actives: 'Plain water + cotton wool ¬∑ or fragrance-free water wipes', evidence: 'High', note: 'Plain water and cotton wool is the most gentle option, especially for newborns. If using wipes, choose fragrance-free, alcohol-free, with pH 5.5. Avoid antibacterial wipes ‚Äî they disrupt the skin microbiome.', ingredients: 'Aqua only ¬∑ or fragrance-free water wipes ¬∑ pH 5.5', avoid: 'Fragrance ¬∑ alcohol ¬∑ antibacterial ingredients ¬∑ baby powder (talc inhalation risk, cornstarch may worsen fungal rash)' },
    { step: 'Barrier cream', time: 'At every nappy change ¬∑ preventively', actives: 'Zinc Oxide 10‚Äì40% or Petrolatum or Dimethicone', evidence: 'Very High', note: 'Apply a thick layer as a physical barrier between skin and moisture at every change ‚Äî not just when rash appears. Zinc oxide is anti-inflammatory and antimicrobial. Petrolatum creates a waterproof barrier. Do not wipe off completely at next change ‚Äî rub over it instead.', ingredients: 'Zinc Oxide 10‚Äì40% ¬∑ Petrolatum ¬∑ Dimethicone ¬∑ Lanolin (avoid if wool allergy)', avoid: 'Fragrance ¬∑ talc (inhalation risk) ¬∑ boric acid ¬∑ adult moisturisers without zinc oxide ¬∑ antifungal creams without confirmed fungal infection' },
  ],
  sensitive: [
    { step: 'Cleanse', time: 'Daily ¬∑ minimal contact time', actives: 'Plain water or pH 5.5 fragrance-free syndet', evidence: 'High', note: 'For reactive baby skin, less is more. Plain water is always the safest choice. If a wash product is needed, choose the shortest ingredient list possible ‚Äî fewer ingredients = fewer potential irritants. Avoid all fragrance, colourants, and preservatives where possible.', ingredients: 'Aqua only ¬∑ or single-ingredient syndet ¬∑ fragrance-free', avoid: 'Everything non-essential ¬∑ fragrance ¬∑ SLS ¬∑ CAPB if reactive ¬∑ colourants ¬∑ essential oils' },
    { step: 'Moisturise', time: 'After bathing ¬∑ when dry', actives: 'Petrolatum or single-ingredient emollient', evidence: 'High', note: 'For very sensitive skin, pure petrolatum (Vaseline) is the safest moisturiser ‚Äî it has the shortest possible ingredient list (1 ingredient), is inert, non-allergenic, and highly effective at reducing TEWL. Add ceramides if tolerated.', ingredients: 'Petrolatum (Vaseline, 1 ingredient) ¬∑ or Ceramide cream with minimal preservatives', avoid: 'Products with more than 10 ingredients ¬∑ fragrance ¬∑ essential oils ¬∑ nut-based oils ¬∑ coloured or scented products' },
  ],
  maintenance: [
    { step: 'Bath', time: '2‚Äì3√ó per week for newborns ¬∑ daily from 3+ months', actives: 'Lukewarm water (37¬∞C) ¬∑ fragrance-free if needed', evidence: 'High', note: 'Healthy skin needs less intervention than marketing suggests. For babies with normal skin, water alone is sufficient for the first month. After that, a gentle fragrance-free baby wash is optional, not necessary.', ingredients: 'Aqua ¬∑ or gentle fragrance-free syndet', avoid: 'Over-bathing ¬∑ hot water ¬∑ adult products ¬∑ anything with fragrance' },
    { step: 'Moisturise', time: 'After bathing if dry areas appear', actives: 'Light ceramide lotion or Petrolatum on dry patches', evidence: 'Medium', note: 'Normal baby skin does not need daily moisturising. If dry patches appear, apply a light, fragrance-free moisturiser after bathing. Thick emollients are only needed for very dry or eczema-prone skin.', ingredients: 'Ceramide NP ¬∑ Glycerin ¬∑ Petrolatum on dry patches ¬∑ no fragrance', avoid: 'Fragrance ¬∑ nut oils ¬∑ essential oils ¬∑ adult products' },
    { step: 'Sun protection', time: 'AM ¬∑ outdoors ¬∑ from 6 months', actives: 'Shade + UPF 50+ clothing under 6 months ¬∑ Zinc Oxide SPF50+ from 6 months', evidence: 'Very High', note: 'Under 6 months: shade, hat, and UPF50+ clothing is safer than sunscreen. From 6 months: apply mineral SPF50+ (Zinc Oxide only) to exposed skin. Avoid between 11am and 3pm where possible.', ingredients: 'Zinc Oxide 15‚Äì20% ¬∑ Titanium Dioxide ¬∑ no chemical filters', avoid: 'Direct sun under 6 months ¬∑ chemical SPF filters ¬∑ spray sunscreens' },
  ],
};

// ====== PROFILE SYSTEM ======
let savedProfiles = [];
let editingProfileId = null;

async function loadProfiles() {
  try { const r = await window.storage.get('babydecide-profiles'); savedProfiles = r ? JSON.parse(r.value) : []; } catch(e) { savedProfiles = []; }
  renderProfilesList();
}
async function persistProfiles() {
  try { await window.storage.set('babydecide-profiles', JSON.stringify(savedProfiles)); } catch(e) {}
}

function renderProfilesList() {
  const el = document.getElementById('profiles-list');
  if (!savedProfiles.length) { el.innerHTML = ''; return; }
  el.innerHTML = `
    <div style="margin-bottom:12px; font-size:11px; text-transform:uppercase; letter-spacing:0.1em; color:var(--ink-muted);">Saved Profiles (${savedProfiles.length})</div>
    <div style="display:flex; flex-direction:column; gap:10px;" id="profiles-cards">
      ${savedProfiles.map(p => `
        <div class="card" style="padding:16px; display:flex; align-items:center; gap:12px; cursor:pointer;" data-pid="${p.id}">
          <div style="flex:1; pointer-events:none;">
            <div style="font-family:'DM Serif Display',serif; font-size:16px; margin-bottom:6px;">${p.name}</div>
            <div style="display:flex; flex-wrap:wrap; gap:4px;">${p.chips.slice(0,3).map(c => `<span class="tag tag-muted">${c}</span>`).join('')}</div>
          </div>
          <div style="display:flex; gap:6px; flex-shrink:0;">
            <button data-action="edit" data-id="${p.id}" style="background:none; border:1px solid var(--border); border-radius:4px; padding:6px 10px; cursor:pointer; font-size:11px; font-family:'DM Mono',monospace; color:var(--ink-muted);">Edit</button>
            <button data-action="delete" data-id="${p.id}" style="background:none; border:1px solid var(--border); border-radius:4px; padding:6px 10px; cursor:pointer; font-size:11px; font-family:'DM Mono',monospace; color:var(--accent);">‚úï</button>
          </div>
        </div>`).join('')}
    </div>`;
  const cards = document.getElementById('profiles-cards');
  if (cards) cards.addEventListener('click', function(e) {
    const btn = e.target.closest('button[data-action]');
    if (btn) { e.stopPropagation(); if (btn.dataset.action === 'edit') editProfile(btn.dataset.id); if (btn.dataset.action === 'delete') deleteProfile(btn.dataset.id); }
    else { const card = e.target.closest('[data-pid]'); if (card) viewProfile(card.dataset.pid); }
  });
}

function saveProfile() {
  const name = document.getElementById('profileName').value.trim() || 'Baby';
  const age = document.getElementById('babyAge').value;
  const skinType = document.getElementById('skinType').value;
  const concern = document.getElementById('primaryConcern').value;
  if (!age || !concern) { alert('Please select age and primary concern.'); return; }
  const conditions = Array.from(document.querySelectorAll('#conditions .checkbox-chip.selected')).map(c => c.textContent);
  const chips = [age, skinType || 'skin', concern, ...conditions.filter(c => c !== 'None')];
  const profile = { id: editingProfileId || ('p' + Date.now()), name, age, skinType, concern, conditions, chips, savedAt: new Date().toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' }) };
  if (editingProfileId) { savedProfiles = savedProfiles.map(p => p.id === editingProfileId ? profile : p); editingProfileId = null; }
  else savedProfiles.push(profile);
  persistProfiles(); renderProfilesList(); viewProfile(profile.id); resetForm();
}

function viewProfile(id) {
  const p = savedProfiles.find(pr => pr.id === id);
  if (!p) return;
  document.getElementById('profile-result-name').textContent = p.name;
  document.getElementById('profile-chips').innerHTML = p.chips.map(c => `<div class="profile-chip">‚úì ${c}</div>`).join('') + `<div class="profile-chip" style="color:var(--ink-muted)">Saved ${p.savedAt}</div>`;
  const architecture = routineDB[p.concern] || routineDB.maintenance;
  const ec = (e) => e === 'Very High' || e === 'High' ? 'tag-green' : e === 'Medium-High' || e === 'Medium' ? 'tag-amber' : 'tag-muted';
  document.getElementById('routine-architecture').innerHTML = architecture.map((step, i) => {
    const q = encodeURIComponent('best baby ' + step.step.toLowerCase() + ' ' + step.actives.split('¬∑')[0].trim().substring(0,40) + ' fragrance free');
    return `<div style="padding:16px 0; border-bottom:1px solid var(--border);">
      <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px; margin-bottom:10px;">
        <div style="flex:1; min-width:0;">
          <div class="routine-step-label" style="margin-bottom:4px;"><span class="step-num">${i+1}</span>${step.step}<span style="margin-left:8px; font-size:10px; color:var(--ink-muted); text-transform:none; letter-spacing:0; font-weight:400;">‚è± ${step.time}</span></div>
          <div style="font-family:'DM Serif Display',serif; font-size:15px; line-height:1.3;">${step.actives}</div>
        </div>
        <div style="display:flex; flex-direction:column; align-items:flex-end; gap:5px; flex-shrink:0;">
          <span class="tag ${ec(step.evidence)}">Evidence: ${step.evidence}</span>
          <a href="https://www.google.com/search?q=${q}" target="_blank" style="display:inline-flex; align-items:center; gap:4px; background:var(--surface); border:1px solid var(--border); border-radius:5px; padding:5px 9px; font-family:'DM Mono',monospace; font-size:9px; text-decoration:none; color:var(--ink-muted); white-space:nowrap; text-transform:uppercase; letter-spacing:0.06em; cursor:pointer;">üîç Search</a>
        </div>
      </div>
      <div style="font-size:12px; color:var(--ink-muted); line-height:1.6; margin-bottom:10px;">${step.note}</div>
      ${step.ingredients !== '‚Äî' ? `<div style="display:flex; gap:8px; align-items:baseline; margin-bottom:6px; flex-wrap:wrap;"><span style="font-size:10px; text-transform:uppercase; letter-spacing:0.08em; color:var(--green); flex-shrink:0;">‚úì Look for</span><span style="font-size:11px; color:var(--ink-muted); font-family:'DM Mono',monospace;">${step.ingredients}</span></div>` : ''}
      ${step.avoid ? `<div style="display:flex; gap:8px; align-items:baseline; flex-wrap:wrap;"><span style="font-size:10px; text-transform:uppercase; letter-spacing:0.08em; color:var(--accent); flex-shrink:0;">‚úó Avoid</span><span style="font-size:11px; color:var(--ink-muted); font-family:'DM Mono',monospace;">${step.avoid}</span></div>` : ''}
    </div>`;
  }).join('');
  document.getElementById('profile-result').style.display = 'block';
  document.getElementById('profile-result').scrollIntoView({ behavior: 'smooth' });
}

function editProfile(id) {
  const p = savedProfiles.find(pr => pr.id === id); if (!p) return;
  editingProfileId = id;
  document.getElementById('profileName').value = p.name;
  document.getElementById('babyAge').value = p.age;
  document.getElementById('skinType').value = p.skinType || '';
  document.getElementById('primaryConcern').value = p.concern;
  document.querySelectorAll('#conditions .checkbox-chip').forEach(c => c.classList.toggle('selected', p.conditions.includes(c.textContent)));
  document.getElementById('profile-form-title').innerHTML = '<span class="card-icon" style="background:#fdefd0">‚úé</span> Edit Profile';
  document.getElementById('cancel-edit-btn').style.display = 'inline-flex';
  document.getElementById('profile-form-card').scrollIntoView({ behavior: 'smooth' });
}
function deleteProfile(id) {
  if (!confirm('Delete this profile?')) return;
  savedProfiles = savedProfiles.filter(p => p.id !== id);
  persistProfiles(); renderProfilesList();
  if (!savedProfiles.length) document.getElementById('profile-result').style.display = 'none';
}
function cancelEdit() { editingProfileId = null; resetForm(); }
function resetForm() {
  document.getElementById('profileName').value = '';
  document.getElementById('babyAge').value = '';
  document.getElementById('skinType').value = '';
  document.getElementById('primaryConcern').value = '';
  document.querySelectorAll('#conditions .checkbox-chip').forEach(c => c.classList.remove('selected'));
  document.getElementById('profile-form-title').innerHTML = '<span class="card-icon" style="background:#d8ead9">+</span> New Baby Profile';
  document.getElementById('cancel-edit-btn').style.display = 'none';
}
loadProfiles();

// ====== SCANNER ======
const babyActiveMap = {
  'ceramide': { function: 'Barrier lipid ¬∑ essential for developing skin', badge: 'tag-green' },
  'glycerin': { function: 'Humectant ¬∑ gentle and safe', badge: 'tag-green' },
  'petrolatum': { function: 'Occlusive ¬∑ gold standard for TEWL reduction', badge: 'tag-green' },
  'zinc oxide': { function: 'Barrier + anti-inflammatory (nappy rash)', badge: 'tag-green' },
  'panthenol': { function: 'Provitamin B5 ¬∑ calming and barrier repair', badge: 'tag-green' },
  'sodium hyaluronate': { function: 'Humectant ¬∑ moisture retention', badge: 'tag-green' },
  'allantoin': { function: 'Soothing ¬∑ promotes healing', badge: 'tag-green' },
  'shea butter': { function: 'Emollient ¬∑ barrier support (check nut allergy)', badge: 'tag-amber' },
  'dimethicone': { function: 'Silicone barrier ¬∑ protective, non-absorbing', badge: 'tag-green' },
};
const babyWatchlistMap = {
  'parfum': { risk: 'High', note: 'Fragrance is the #1 contact allergen in baby products. Baby skin absorbs more readily ‚Äî avoid entirely.' },
  'fragrance': { risk: 'High', note: 'Same as Parfum. No fragrance should be in baby products.' },
  'linalool': { risk: 'High', note: 'Fragrance allergen. Common in "natural" products. Highly sensitizing.' },
  'limonene': { risk: 'High', note: 'Fragrance allergen. Found in citrus essential oils.' },
  'alcohol denat': { risk: 'High', note: 'Drying alcohol. Disrupts barrier especially in babies.' },
  'methylisothiazolinone': { risk: 'High', note: 'Preservative. EU-banned in leave-on products. High allergen ‚Äî avoid in babies.' },
  'phenoxyethanol': { risk: 'Medium', note: 'Common preservative. UK/EU advisory to avoid in products for children under 3 (Japan banned in baby products).' },
  'sodium lauryl sulfate': { risk: 'High', note: 'Harsh surfactant. Strips natural lipids from baby skin barrier.' },
  'tea tree oil': { risk: 'High', note: 'Essential oil. Hormonal disruption concerns and skin sensitiser. Not for babies.' },
  'lavender oil': { risk: 'Medium', note: 'Essential oil. Potential sensitiser and hormonal disruption concerns in babies.' },
  'oxybenzone': { risk: 'High', note: 'Chemical UV filter. High absorption through baby skin. Avoid entirely.' },
  'propylene glycol': { risk: 'Medium', note: 'Penetration enhancer. Increases absorption of other ingredients ‚Äî higher concern in babies.' },
};

const demoProduct = {
  name: 'Mustela Hydra B√©b√© Body Lotion', brand: 'Category: Baby Moisturiser',
  actives: [
    { name: 'Ceramide', conc: 70, level: 'Barrier lipid', badge: 'tag-green', function: 'Barrier lipid ¬∑ essential for developing skin' },
    { name: 'Glycerin', conc: 80, level: 'Humectant', badge: 'tag-green', function: 'Humectant ¬∑ gentle and safe' },
    { name: 'Panthenol (B5)', conc: 50, level: 'Soothing', badge: 'tag-green', function: 'Provitamin B5 ¬∑ calming and barrier repair' },
  ],
  watchlist: [],
  alerts: [
    { type: 'green', icon: '‚úì', text: 'Fragrance-free formula ‚Äî ideal for sensitive baby skin.' },
    { type: 'green', icon: '‚úì', text: 'No harsh preservatives detected. Phenoxyethanol-free.' },
  ],
  safetyScore: 91,
  allIngredients: ['Aqua', 'Glycerin', 'Isopropyl Palmitate', 'Cetearyl Alcohol', 'Ceramide NP', 'Panthenol', 'Allantoin', 'Tocopherol', 'Xanthan Gum', 'Sodium Hyaluronate', 'Carbomer', 'Sodium Hydroxide', 'Disodium EDTA', 'Ethylhexylglycerin']
};

function simulateScan() { displayProduct(demoProduct); }
function analyzeINCIInput() {
  const input = document.getElementById('inci-input').value.trim();
  if (!input) { simulateScan(); return; }
  const ingredients = input.split(',').map(i => i.trim()).filter(Boolean);
  const actives = [], watchlist = [], alerts = [];
  const lc = ingredients.map(i => i.toLowerCase());
  for (const [key, val] of Object.entries(babyActiveMap)) { const m = ingredients.find(i => i.toLowerCase().includes(key)); if (m) actives.push({ name: m, conc: 60, level: 'Beneficial', badge: val.badge, function: val.function }); }
  for (const [key, val] of Object.entries(babyWatchlistMap)) { const m = ingredients.find(i => i.toLowerCase().includes(key)); if (m) watchlist.push({ name: m, risk: val.risk, note: val.note }); }
  const hasFragrance = lc.some(i => i.includes('parfum') || i.includes('fragrance') || i.includes('linalool') || i.includes('limonene'));
  const hasMIT = lc.some(i => i.includes('methylisothiazolinone'));
  const hasSLS = lc.some(i => i === 'sodium lauryl sulfate' || i === 'sls');
  if (hasFragrance) alerts.push({ type: 'red', icon: '‚úó', text: 'Fragrance detected. Not recommended for baby products ‚Äî fragrance is the #1 allergen and absorbs more readily through baby skin.' });
  if (hasMIT) alerts.push({ type: 'red', icon: '‚úó', text: 'Methylisothiazolinone (MIT) detected. EU-banned in leave-on products. High allergen ‚Äî avoid in all baby products.' });
  if (hasSLS) alerts.push({ type: 'red', icon: '‚úó', text: 'SLS detected. Too harsh for baby skin. Strips developing lipid barrier.' });
  if (!hasFragrance && !hasMIT && !hasSLS) alerts.push({ type: 'green', icon: '‚úì', text: 'No major red flags detected. Always patch-test a new product on a small area for 48 hours first.' });
  const wScore = Math.max(0, 100 - (watchlist.filter(w => w.risk === 'High').length * 20) - (watchlist.filter(w => w.risk === 'Medium').length * 8));
  displayProduct({ name: 'Custom Baby Product', brand: 'INCI Analysis ¬∑ ' + ingredients.length + ' ingredients', actives, watchlist, alerts, safetyScore: wScore, allIngredients: ingredients });
}

function displayProduct(p) {
  document.getElementById('product-name').textContent = p.name;
  document.getElementById('product-brand').textContent = p.brand;
  document.getElementById('risk-score').textContent = p.safetyScore;
  document.getElementById('risk-score').style.color = p.safetyScore >= 80 ? 'var(--green)' : p.safetyScore >= 60 ? 'var(--amber)' : 'var(--accent)';
  document.getElementById('alerts-area').innerHTML = p.alerts.map(a => `<div class="alert alert-${a.type === 'green' ? 'green' : a.type === 'amber' ? 'amber' : 'red'}"><span>${a.icon}</span><div>${a.text}</div></div>`).join('');
  document.getElementById('active-ingredients').innerHTML = p.actives.length ? p.actives.map(a => `<div class="ingredient-row"><div style="flex:1"><div style="font-size:12px; font-weight:500; margin-bottom:2px;">${a.name}</div><div style="font-size:11px; color:var(--ink-muted);">${a.function}</div></div><span class="tag ${a.badge}">${a.level}</span></div>`).join('') : '<div style="color:var(--ink-muted); font-size:12px; padding:8px 0">No specific beneficial ingredients detected.</div>';
  const wl = p.watchlist;
  if (wl && wl.length) {
    document.getElementById('watch-ingredients').innerHTML = wl.map(w => `<div class="ingredient-row"><div style="flex:1"><div style="font-size:12px; font-weight:500; margin-bottom:2px;">${w.name}</div><div style="font-size:11px; color:var(--ink-muted);">${w.note}</div></div><span class="tag tag-${w.risk === 'High' ? 'red' : 'amber'}">${w.risk}</span></div>`).join('');
    document.getElementById('watch-empty').style.display = 'none';
  } else {
    document.getElementById('watch-ingredients').innerHTML = '';
    document.getElementById('watch-empty').style.display = 'block';
  }
  document.getElementById('all-ingredients').innerHTML = p.allIngredients.map((ing, i) => `<div class="ingredient-row"><span style="font-size:10px; color:var(--ink-muted); width:20px; flex-shrink:0;">${i+1}</span><span style="flex:1; font-size:12px;">${ing}</span><div class="ingredient-bar"><div class="ingredient-bar-fill" style="width:${Math.max(4, 100 - i * (100/p.allIngredients.length))}%; background:${i < 3 ? 'var(--accent)' : i < 7 ? 'var(--amber)' : 'var(--border)'};"></div></div></div>`).join('');
  document.getElementById('scanner-input').style.display = 'none';
  document.getElementById('scanner-result').style.display = 'block';
}
function resetScanner() {
  document.getElementById('scanner-input').style.display = 'block';
  document.getElementById('scanner-result').style.display = 'none';
  document.getElementById('inci-input').value = '';
}
</script>
</body>
</html>
